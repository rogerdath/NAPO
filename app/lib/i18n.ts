import { create } from 'zustand';

export type Language = 'en' | 'nb';

interface I18nStore {
    language: Language;
    setLanguage: (lang: Language) => void;
}

export const useI18n = create<I18nStore>((set) => ({
    language: 'en',
    setLanguage: (lang) => set({ language: lang }),
}));

const translations = {
    en: {
        common: {
            settings: 'Settings',
            language: 'Language',
            theme: 'Theme',
            save: 'Save',
            cancel: 'Cancel',
            light: 'Light',
            dark: 'Dark',
            system: 'System',
            loading: 'Loading...',
            error: 'Error',
            success: 'Success',
            actions: 'Actions',
            edit: 'Edit',
            delete: 'Delete',
            view: 'View',
            close: 'Close',
            all: 'All',
            total: 'Total',
            copy: 'Copy',
            upload: 'Upload',
        },
        navigation: {
            transform: 'Transform',
            contracts: 'Contracts',
            history: 'History',
            dashboard: 'Dashboard',
            contractManager: 'Contract Manager',
        },
        dashboard: {
            title: 'Dashboard',
            description: 'Overview of contracts and resources',
            totalContracts: 'Total Contracts',
            totalResources: 'Total Resources',
            averageCost: 'Average Cost per KM',
            avtaleKontor: 'AvtaleKontor',
            contractTypes: 'Contract Types',
            statistics: 'Statistics',
            licenses: 'Licenses per AvtaleKontor',
        },
        transform: {
            title: 'Transform CSV',
            description: 'Upload and transform CSV files into structured contract data',
            uploadTitle: 'Upload CSV Files',
            selectFiles: 'Select CSV files',
            uploadSuccess: 'Successfully stored {count} files',
            uploadError: 'Failed to upload files. Please try again.',
            processing: 'Processing files...',
            validationError: 'Validation error in file: {filename}',
            relationsTitle: 'Data Relations',
        },
        contracts: {
            title: 'Contract Manager',
            description: 'Search, edit, and manage contracts',
            search: 'Search in all fields...',
            filters: 'Search and Filters',
            advancedSearch: 'Advanced Search',
            tableView: 'Table View',
            jsonView: 'JSON View',
            formView: 'Form View',
            structureView: 'Structure',
            id: 'ID',
            avtaleKontor: 'AvtaleKontor',
            avtaleName: 'AvtaleNavn',
            type: 'Type',
            transport: 'Transport',
            location: 'Location',
            resources: 'Resources',
            cost: 'Cost',
            details: 'Details',
            filterByType: 'Filter by Type',
            filterByAvtaleKontor: 'Filter by AvtaleKontor',
            filterByPostalCode: 'Filter by Postal Code',
            noResults: 'No contracts found',
            filtersApplied: 'Filters applied successfully',
            selectContractToEdit: 'Select a contract to edit',
            editContract: 'Edit Contract',
            jsonStructure: 'JSON Structure',
            saveStructure: 'Save Structure',
            initializing: 'Initializing contract database...',
            loadingContracts: 'Loading contracts...',
            databaseError: 'Error initializing database',
        },
        history: {
            title: 'History',
            description: 'View previous transformations and exports',
            previousExports: 'Previous Exports',
            noHistory: 'No previous exports found',
            exportDate: 'Export Date',
            fileSize: 'File Size',
            fileName: 'File Name',
            downloadFile: 'Download File',
            deleteFile: 'Delete File',
            viewDetails: 'View Details',
            confirmDelete: 'Are you sure you want to delete this file?',
        },
        errors: {
            loadingFailed: 'Failed to load data',
            savingFailed: 'Failed to save changes',
            uploadFailed: 'Failed to upload file',
            invalidFormat: 'Invalid file format',
            requiredField: 'This field is required',
            invalidValue: 'Invalid value',
            networkError: 'Network error occurred',
            unexpectedError: 'An unexpected error occurred',
            copyFailed: 'Failed to copy to clipboard',
            noData: 'No data available',
            filterError: 'Error applying filters',
        },
        settings: {
            data: 'Data Management',
            clearData: 'Clear Local Data',
            clearDataDescription: 'This will clear all locally stored data. You will need to reload contracts from CSV files.',
            confirmClearData: 'Are you sure you want to clear all local data? This cannot be undone.',
        },
    },
    no: {
        common: {
            settings: 'Innstillinger',
            language: 'Språk',
            theme: 'Tema',
            save: 'Lagre',
            cancel: 'Avbryt',
            light: 'Lys',
            dark: 'Mørk',
            system: 'System',
            loading: 'Laster...',
            error: 'Feil',
            success: 'Suksess',
            actions: 'Handlinger',
            edit: 'Rediger',
            delete: 'Slett',
            view: 'Vis',
            close: 'Lukk',
            all: 'Alle',
            total: 'Totalt',
            copy: 'Kopier',
            upload: 'Last opp',
        },
        navigation: {
            transform: 'Transformer',
            contracts: 'Avtaler',
            history: 'Historie',
            dashboard: 'Dashbord',
            contractManager: 'Avtalehåndtering',
        },
        dashboard: {
            title: 'Dashbord',
            description: 'Oversikt over avtaler og ressurser',
            totalContracts: 'Totalt antall avtaler',
            totalResources: 'Totalt antall ressurser',
            averageCost: 'Gjennomsnittlig km pris',
            avtaleKontor: 'AvtaleKontor',
            contractTypes: 'Avtaletyper',
            statistics: 'Statistikk',
            licenses: 'Løyver per AvtaleKontor',
        },
        transform: {
            title: 'Transform CSV',
            description: 'Last opp og transformer CSV-filer til strukturerte avtaledata',
            uploadTitle: 'Last opp CSV-filer',
            selectFiles: 'Velg CSV-filer',
            uploadSuccess: 'Vellykket lagring av {count} filer',
            uploadError: 'Kunne ikke laste opp filer. Vennligst prøv igjen.',
            processing: 'Behandler filer...',
            validationError: 'Valideringsfeil i fil: {filename}',
            relationsTitle: 'Datarelasjoner',
        },
        contracts: {
            title: 'Avtalehåndtering',
            description: 'Søk, rediger og administrer avtaler',
            search: 'Søk i alle felt...',
            filters: 'Søk og filtre',
            advancedSearch: 'Avansert søk',
            tableView: 'Tabellvisning',
            jsonView: 'JSON-visning',
            formView: 'Skjemavisning',
            structureView: 'Struktur',
            id: 'ID',
            avtaleKontor: 'AvtaleKontor',
            avtaleName: 'AvtaleNavn',
            type: 'Type',
            transport: 'Transport',
            location: 'Sted',
            resources: 'Ressurser',
            cost: 'Kostnad',
            details: 'Detaljer',
            filterByType: 'Filtrer etter type',
            filterByAvtaleKontor: 'Filtrer etter AvtaleKontor',
            filterByPostalCode: 'Filtrer etter postnummer',
            noResults: 'Ingen avtaler funnet',
            filtersApplied: 'Filtre anvendt',
            selectContractToEdit: 'Velg en avtale å redigere',
            editContract: 'Rediger avtale',
            jsonStructure: 'JSON-struktur',
            saveStructure: 'Lagre struktur',
            initializing: 'Initialiserer avtaledatabase...',
            loadingContracts: 'Laster avtaler...',
            databaseError: 'Feil ved initialisering av database',
        },
        history: {
            title: 'Historie',
            description: 'Se tidligere transformasjoner og eksporter',
            previousExports: 'Tidligere eksporter',
            noHistory: 'Ingen tidligere eksporter funnet',
            exportDate: 'Eksportdato',
            fileSize: 'Filstørrelse',
            fileName: 'Filnavn',
            downloadFile: 'Last ned fil',
            deleteFile: 'Slett fil',
            viewDetails: 'Vis detaljer',
            confirmDelete: 'Er du sikker på at du vil slette denne filen?',
        },
        errors: {
            loadingFailed: 'Kunne ikke laste data',
            savingFailed: 'Kunne ikke lagre endringer',
            uploadFailed: 'Kunne ikke laste opp fil',
            invalidFormat: 'Ugyldig filformat',
            requiredField: 'Dette feltet er påkrevd',
            invalidValue: 'Ugyldig verdi',
            networkError: 'Nettverksfeil oppstod',
            unexpectedError: 'En uventet feil oppstod',
            copyFailed: 'Kunne ikke kopiere til utklippstavlen',
            noData: 'Ingen data tilgjengelig',
            filterError: 'Feil ved anvendelse av filtre',
        },
        settings: {
            data: 'Databehandling',
            clearData: 'Slett lokale data',
            clearDataDescription: 'Dette vil slette alle lokalt lagrede data. Du må laste inn kontrakter fra CSV-filer på nytt.',
            confirmClearData: 'Er du sikker på at du vil slette alle lokale data? Dette kan ikke angres.',
        },
    },
} as const;

export function t(key: string, language: Language | undefined = 'en', params?: Record<string, string | number>): string {
    const keys = key.split('.');
    let current: any = translations[language || 'en'];
    
    for (const k of keys) {
        if (current[k] === undefined) {
            console.warn(`Translation missing for key: ${key} in language: ${language}`);
            return key;
        }
        current = current[k];
    }
    
    if (params) {
        return Object.entries(params).reduce((text, [key, value]) => {
            return text.replace(`{${key}}`, String(value));
        }, current);
    }
    
    return current;
} 